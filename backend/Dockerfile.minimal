FROM node:20-alpine

WORKDIR /app

# 最小限の依存関係
RUN npm install express

# 最小構成サーバー
COPY src/server-minimal.ts ./server.ts

# TypeScriptをインストールしてコンパイル
RUN npm install -g typescript @types/node @types/express
RUN tsc --target ES2020 --module commonjs --esModuleInterop server.ts

EXPOSE 8080

CMD ["node", "server.js"]
